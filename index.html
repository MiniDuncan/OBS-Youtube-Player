<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: none;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="info"></div>
        <div id="player"></div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
      const url = new URL(window.location.href);

      let songID = url.searchParams.get("watch?v");
      let listID = url.searchParams.get("list");
      let title = url.searchParams.get("title") === "true";
      let volume = parseInt(url.searchParams.get("volume") || 45);
      let width = url.searchParams.get("w") || 534;
      let height = url.searchParams.get("h") || 300;
      let quality = url.searchParams.get("quality") || "default";
      let forceQuality = url.searchParams.get("forcequality") === "true";
      let speed = parseFloat(url.searchParams.get('speed') || 1);
      let startSeconds = parseInt(url.searchParams.get("t") || 0);
      let random = url.searchParams.get("random") === "true";
      let loop = url.searchParams.get("loop") !== "false";
      let fade = url.searchParams.get("fade") === "true";
      let debugMode = url.searchParams.get("debug") === "true";
      let hide = url.searchParams.get("hide") === "true";
      let hideWhenStopped = url.searchParams.get('hideWhenStopped') === "true";
      let controls = url.searchParams.get('controls') === "true";

      if (hide) {
        document.querySelector("#player").style.display = "none";
      }

      function debug(msg) {
        if (debugMode) {
          console.log(msg);
        }
      }

      let player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          width: width,
          height: height,
          playerVars: {
            autoplay: 1,
            controls: controls ? 1 : 0,
            showinfo: 0,
            modestbranding: 1,
            playlist: listID,
            loop: loop ? 1 : 0,
            start: startSeconds,
            enablejsapi: 1,
            rel: 0,
            disablekb: 1
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      function onPlayerReady(event) {
        player.setVolume(volume);
        player.setPlaybackRate(speed);
        if (listID) {
          loadAndShufflePlaylist();
        } else {
          player.loadVideoById(songID);
        }
      }

      function loadAndShufflePlaylist() {
        player.cuePlaylist({list: listID});
        player.addEventListener('onReady', function() {
          let playlist = player.getPlaylist();
          shuffleArray(playlist);
          player.cuePlaylist({
            playlist: playlist,
            index: 0,
            startSeconds: startSeconds
          });
          if (random) {
            player.setShuffle(true);
          }
        });
      }

      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }

      function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.ENDED && !loop) {
          player.stopVideo();
        }
        if (event.data === YT.PlayerState.PLAYING) {
          if (fade) {
            fadeVolume();
          }
        }
      }

      function fadeVolume() {
        // Implementation for volume fading if required
      }
    </script>
</body>
</html>
